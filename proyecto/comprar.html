<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="comprar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <title>formulario</title>
</head>
<body>
  <div id="IniciarSecion">
    <button id="botonInicio">&#128100
        
    </button>
    <div id="CartelInicioSecion" class="an animate__animated animate__fadeInDown ">
      <div id="dentroDelInicio">
          
      <h1>Iniciar Sesion</h1>
      
      <label for="NombreUsuario" id="Usuario">Usuario</label>
      <input id="inputIngresar" type="text">
      <label for="Contrase√±a" id="Contrase√±a">Contrase√±a</label>
      <input id="Inputcontrase√±a" id type="password">
      <button id="ingresar" onclick="iniciarSesion()">Ingresar</button>
      
      <button id="registrarse" >Registrarse</button>
      <button id="cerrarInicio">Cerrar</button>
      <a href="">Olvide la contrae√±a</a>
  </div>
  </div>
  <div id="InicioCorrecto">
  <div id="cacasInicio" >

      <h1>Inicio exitoso</h1>
      <p id="iniciosesionPP">
      </p>
      <button id="Entendido">Entendido</button>
      <button><a href="../proyecto/formulario.html">Ir al formulario</a></button>

  </div>
</div>



  <div id="contenedorRegistro">
  <div id="dentroDelregistro">
      
  <h1>Registrase</h1>
  
  <label for="NombreUsuario" id="Usuario">Ingrese Usuario a registrar</label>
  <input id="inputRegistrar" type="text">
  <label for="Contrase√±a" id="Contrase√±a">Ingrese contrase√±a nueva</label>
  <input id="Inputcontrase√±aR" type="password">
  <button id="RegistrarUS">Registrarse</button>
  <button id="cerrarInicioR">Cerrar</button>
  
</div>
</div>
</div>
  <div id="contenedorCarro">
    <button id="CarroCompras">üõí<p id="precios">0</p></button>
  </div>
  
  <div id="hamburguer">
        
    <nav class="menu animate__animated animate__delay-5s" id="menu">
        <button id="cerrarHambur" onclick="hamburguer()">X</button>
        <ul>
            <li><a href="InicioPag.html">Inicio</a></li>
            <li><a href="#productos">Productos</a></li>
            <li><a href="puntosdeventa.html">Puntos de venta</a></li>
            <li><a href="comunidad.html">Comunidad</a></li>
            <li><a href="InicioPag.html">Asesor</a></li>
        </ul>
    </nav>
</div>
<section class="encabezado animate__animated animate__fadeInDown">
            
  <nav class="nav">
    <div class="grid  item1"><a href="InicioPag.html"><img src="../proyecto/imagenesproyecto/GAMLION.png" alt=""></a></div>
    
    <button class="menu-hamburguesa animate__animated animate__delay-3s" id="menuHamburguesa">
        <div class="barra"></div>
        <div class="barra"></div>
        <div class="barra"></div>
    </button>
 </nav>  
  <img src="" alt="">

  <div class="grid item2">
      <label for="buscar"></label>
      <input class="elimM" list="hola" id="buscar" placeholder="Buscar üîé" name="buscar">
      
      
      <datalist id="hola">
          <option value="Teclados"></option>
          <option value="Ratones"></option>
          <option value="Camaras Web"></option>
          <option value="Teclas"></option>
          <option value="Audio"></option>
      </datalist>
  </div>

  
  <div class="grid elimM item3"><a href="InicioPag.html">Inicio</a></div>
  <div class="grid elimM item4"><a href="#productos">Productos</a></div>
  <div class="grid elimM item5"><a href="puntosdeventa.html">Puntos de venta</a></div>
  <div class="grid elimM item6"><a href="comunidad.html">Comunidad</a></div>
  <div class="grid elimM item7"><a href="InicioPag.html">Asesor</a></div>


</section>
<section class="container1 animate__fadeInBottomRight">
    <div>
        <h1 class="animate__animated animate__fadeInLeftBig">GAMLION PRODUCTOS</h1> 
     </div>
</section>
<div class="contenedorProductos">
    <!--CONTENEDOR TECLADOS-->
<section class="Contteclado animate__animated animate__fadeInLeftBig">
   <h1>TECLADOS</h1>
   <section id="tecladosP"></section>
</section>
<!--CONTENEDOR MOUSE-->
<section class="mouse animate__animated animate__fadeInLeftBig">
<h1>MOUSE</h1>
<section id="mouseP" ></section>
</section>
<!--CONTENEDOR AUDIOS-->
<section class=" audio animate__animated animate__fadeInLeftBig">
    <h1>AUDIO</h1>
    <section id="audioP" ></section>
    </section>
<!--CONTENEDOR MONITORES-->
    <section class="monitor animate__animated animate__fadeInLeftBig">
        <h1>MONITORES</h1>
        <section id="monitorP" ></section>
        </section>
<!--CONTENEDOR PADS-->
        <section class="pads animate__animated animate__fadeInLeftBig">
            <h1>PADS</h1>
            <section id="padsP" ></section>
            </section>

          
</div>
<section class="container2">

<section >

  </section>

</section>
  <section class="ultimo">
    <div class="container5">
        
        <div class="ult fin3"><img src="../proyecto/imagenesproyecto/GAMLION.png" alt=""></div>
        <div class="ult fin2">
            <ul>
                <li><a href="">COMUNIDAD</a></li>
                <li><a href="">CENTRO DE AYUDA</a></li>
                <li><a href="">PUNTOS DE VENTA</a></li>
                <li><a href="">CONTACTO</a></li>
            </ul>

        </div>
        

    </div>
</section>
</div>
    
    </footer>
    <div id="cockies">
      <h3><a href="">Terminos y condiciones</a></h3>
  <h4><a href="">Cookies</a></h4>
  <h5><a href="">GamLion2023‚Ñó</a></h5>
  </div>
 

    <script>

const aggCarta = document.getElementById('tecladosP');
const carritoTotal = document.getElementById('precios');
let totalCarrito = 0;

function cargarJson() {
  fetch('productos.json')
    .then(respuesta => respuesta.json())
    .then(respuesta => {
      respuesta.teclados.forEach(teclado => {
        const agg = document.createElement('header');
        agg.innerHTML = `
          <h1>${teclado.nombre}</h1>
          <img src="${teclado.img}" alt="${teclado.nombre}">
          <p>Precio: ${teclado.precio}</p>
          <div class ='ventaBoton'>
            <button class='agregarAlcarro' data-precio='${teclado.precio}'>Agregar</button><p>0</p>
          </div>
        `;
        aggCarta.appendChild(agg);

        // Asignar evento click a cada bot√≥n de "Agregar"
        const botonAgregar = agg.querySelector('.agregarAlcarro');
        botonAgregar.addEventListener('click', function() {
          agregarAlCarrito(teclado.precio);
        });
      });
    })
    .catch(error => console.error('Error al cargar el JSON:', error));
}


cargarJson();

function agregarAlCarrito(precio) {
  totalCarrito += precio;
  carritoTotal.textContent = totalCarrito;
}
const llamarBoton = document.getElementById('agregarAlcarro')
llamarBoton.addEventListener('click',agregarAlCarrito)
console.log(carritoTotal)

function mostrarFactura() {
  // Crear el contenedor de la factura en el centro
  const facturaContainer = document.createElement('div');
  facturaContainer.id = 'facturaContainer';
  document.body.appendChild(facturaContainer);

  // Mostrar la factura en el contenedor
  carrito.forEach(producto => {
    const facturaItem = document.createElement('div');
    facturaItem.innerHTML = `
      <p>${producto.nombre}</p>
      <p>Precio: ${producto.precio}</p>
      <hr>
    `;
    facturaContainer.appendChild(facturaItem);
  });

  // Mostrar el precio total en la factura
  const totalItem = document.createElement('div');
  totalItem.innerHTML = `<p>Total: ${totalCarrito}</p>`;
  facturaContainer.appendChild(totalItem);

  // Agregar la informaci√≥n al historial del usuario
  if (usuarioActual) {
    const historialUsuario = usuarioActual.historial || {};
    // Agregar la informaci√≥n actual al historial
    carrito.forEach(producto => {
      const nombreProducto = producto.nombre.replace(/\s+/g, ''); // Eliminar espacios para usar como clave
      historialUsuario[nombreProducto] = (historialUsuario[nombreProducto] || 0) + 1;
    });
    historialUsuario.valorTotal = (historialUsuario.valorTotal || 0) + totalCarrito;

    // Actualizar el historial en el JSON (aqu√≠ necesitar√≠as la l√≥gica de escritura en el JSON)
    usuarioActual.historial = historialUsuario;
    // Aqu√≠ deber√≠as llamar a tu funci√≥n o servicio para actualizar el JSON en el backend
    // guardaUsuarioActualEnJson(usuarioActual);
  }
}
const inicioSecion = document.getElementById('botonInicio')

inicioSecion.addEventListener('mouseover',cambiarcolor)
inicioSecion.addEventListener('mouseout',cambiarcolor2)

///
const desplegarInicio = document.getElementById('CartelInicioSecion');

function AbrirInicio() {
desplegarInicio.style.display = (desplegarInicio.style.display === 'none') ? 'flex' : 'none';
}

const inicio = document.getElementById('botonInicio');
inicio.addEventListener('click', AbrirInicio);
function cambiarcolor(){
        inicioSecion.style.filter = 'invert(0)'
        inicioSecion.style.width = '80px'
        inicioSecion.style.height = '40px'
        inicioSecion.textContent= 'iniciar secion'
        inicioSecion.style.transition = '0.5s ease-out'
        inicioSecion.style.backgroundColor = 'black'
        inicioSecion.style.color = 'white'
        
       

        
    }
    function cambiarcolor2(){
        inicioSecion.style.filter = 'invert(0)'
         inicioSecion.style.width = ''
        inicioSecion.style.height = ''
        inicioSecion.innerHTML= '&#128100'
        inicioSecion.style.transition = '0.5s ease-out'
     
        

    }
    const URL_BASE = 'http://localhost:3000';
const USUARIOS_ENDPOINT = '/usuarios';
const CARRITO_ENDPOINT = '/carrito';

document.addEventListener("DOMContentLoaded", function () {
  // Resto de tu c√≥digo aqu√≠

  // Verificar si el usuario ya tiene una sesi√≥n activa
  const usuarioGuardado = JSON.parse(sessionStorage.getItem('usuario'));
  if (usuarioGuardado) {
    alert(`¬°Bienvenido de nuevo, ${usuarioGuardado.nombre}!`);
    // Recuperar informaci√≥n del carrito si existe
    const carritoGuardado = JSON.parse(localStorage.getItem('carrito')) || { total: 0 };
    totalCarrito = carritoGuardado.total;
    carritoTotal.textContent = totalCarrito;
  }
});

// Funci√≥n para iniciar sesi√≥n

function iniciarSesion() {
  const username = document.getElementById('inputIngresar').value;
  const password = document.getElementById('Inputcontrase√±a').value;

  // Verificar si el usuario existe
  fetch(`${URL_BASE}${USUARIOS_ENDPOINT}?nombre=${username}&contrase√±a=${password}`)
    .then(respuesta => respuesta.json())
    .then(usuarios => {
      if (usuarios.length > 0) {
        // Usuario v√°lido, iniciar sesi√≥n
        const usuario = usuarios[0];
        alert(`¬°Bienvenido, ${username}!`);
        // Simulaci√≥n de inicio de sesi√≥n persistente
        sessionStorage.setItem('usuario', JSON.stringify(usuario));
        // Recuperar informaci√≥n del carrito si existe
        const carritoGuardado = JSON.parse(localStorage.getItem('carrito')) || { total: 0 };
        totalCarrito = carritoGuardado.total;
        carritoTotal.textContent = totalCarrito;
      } else {
        // Usuario no encontrado
        alert('Credenciales incorrectas. Intenta de nuevo o reg√≠strate.');
      }
    })
    .catch(error => console.error('Error al iniciar sesi√≥n:', error));
}
    



  function registrarUsuario() {
  const newUsername = document.getElementById('inputRegistrar').value;
  const newPassword = document.getElementById('Inputcontrase√±aR').value;

  // Verificar si el usuario ya existe
  fetch(`${URL_BASE}${USUARIOS_ENDPOINT}?nombre=${newUsername}`)
    .then(respuesta => respuesta.json())
    .then(usuarios => {
      if (usuarios.length > 0) {
        alert('Este nombre de usuario ya est√° registrado. Por favor, elige otro.');
      } else {
        // Si el usuario no existe, proceder con el registro
        fetch(`${URL_BASE}${USUARIOS_ENDPOINT}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ nombre: newUsername, contrase√±a: newPassword }),
        })
          .then(respuesta => respuesta.json())
          .then(usuarioRegistrado => {
            // Recuperar el usuario reci√©n registrado
            return fetch(`${URL_BASE}${USUARIOS_ENDPOINT}/${usuarioRegistrado.id}`);
          })
          .then(respuesta => respuesta.json())
          .then(usuario => {
            // Utilizar el nombre de usuario registrado
            alert(`Usuario ${newUsername} registrado con √©xito. ¬°Ahora puedes iniciar sesi√≥n!`);
          })
          .catch(error => console.error('Error al registrar usuario:', error));
      }
    })
    .catch(error => console.error('Error al verificar existencia del usuario:', error));
}

    const ValidarRegistro = document.getElementById('RegistrarUS')
    ValidarRegistro.addEventListener('click',registrarUsuario)


    const CartelR = document.getElementById('contenedorRegistro')

    const loginUsername = document.getElementById('inputIngresar').value;
    const loginPassword = document.getElementById('Inputcontrase√±a').value;
    

    function RegistrarCartel() {
    CartelR.style.display = (CartelR.style.display === 'none') ? 'flex' : 'none';
    CerrarInicio.style.display = (CerrarInicio.style.display === 'none') ? 'flex' : 'none';
    if(loginUsername=='' && loginPassword == ''){
     CerrarInicio.style.display = (CerrarInicio.style.display === 'none') ? 'flex' : 'none'
    }
    }
   const registrarBoton = document.getElementById('registrarse');
   registrarBoton.addEventListener('click',RegistrarCartel);
    

   
   function CerrarR() {
    CartelR.style.display = (CartelR.style.display === 'none') ? 'flex' : 'none';
}
    

    const cerrarRegistro = document.getElementById('cerrarInicioR')
    cerrarRegistro.addEventListener('click', CerrarR);

    const botonEntendido = document.getElementById('Entendido')
    botonEntendido.addEventListener('click',()=>{
        const InicioExitoso = document.getElementById('InicioCorrecto')
        InicioExitoso.style.display = (InicioExitoso.style.display === 'none') ? 'flex' : 'none'; 
    })
  

</script>

   

    
</body>
</html>